<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    
    
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>local value - Meridian Information</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Library/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Library/" class="btn btn-xs btn-link">
        Index
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../define_error/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../define_error/" class="btn btn-xs btn-link">
        #define error
      </a>
    </div>
    
  </div>

    

    <hr>
<h3> ローカル変数名のリスト </h3>
<hr>
<p><br></p>
<h4><b>バージョン表示</b></h4>
<table>
<thead>
<tr>
<th>型</th>
<th>変数名</th>
<th>バージョン書式</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>#define</td>
<td>VERSION</td>
<td>"Meridian_xxx_for_xxx_20yy.mm.dd"</td>
<td>バージョン表示</td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>ライブラリ等のインスタンス</b></h4>
<table>
<thead>
<tr>
<th>型</th>
<th>インスタンス名</th>
<th>使用ライブラリ</th>
</tr>
</thead>
<tbody>
<tr>
<td>MERIDIANFLOW::Meridian</td>
<td>mrd</td>
<td>Meridian.h</td>
</tr>
<tr>
<td>WiFiUDP</td>
<td>udp</td>
<td>WiFiUdp.h</td>
</tr>
<tr>
<td>ESP32DMASPI::Slave</td>
<td>slave</td>
<td>ESP32DMASPISlave.h</td>
</tr>
<tr>
<td>ESP32Wiimote</td>
<td>wiimote</td>
<td>ESP32Wiimote.h</td>
</tr>
<tr>
<td>File</td>
<td>sdfile</td>
<td>SD.h</td>
</tr>
<tr>
<td>MPU6050</td>
<td>mpu6050</td>
<td>ESP32Wiimote.h</td>
</tr>
<tr>
<td>IcsHardSerialClass</td>
<td>ics_L(&amp;Serial2, PIN_EN_L, ICS_BAUDRATE, ICS_TIMEOUT)</td>
<td>IcsHardSerialClass.h</td>
</tr>
<tr>
<td>IcsHardSerialClass</td>
<td>ics_R(&amp;Serial3, PIN_EN_R, ICS_BAUDRATE, ICS_TIMEOUT)</td>
<td>IcsHardSerialClass.h</td>
</tr>
<tr>
<td>IcsHardSerialClass</td>
<td>ics_C(&amp;Serial1, PIN_EN_3, ICS_BAUDRATE, ICS_TIMEOUT)</td>
<td>IcsHardSerialClass.h</td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>Meridim配列用の共用体</b></h4>
<p>※ DMA使用時に配列末尾のデータが欠損する仕様を回避するため, 配列要素を多くすることで対策. </p>
<table>
<thead>
<tr>
<th>Meridim90Union共用体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>typedef Union {<br>short sval[MRDM_LEN + 4];<br>unsigned short usval[MRDM_LEN + 2];<br>uint8_t bval[  + 4];<br>uint8_t ubval[MRDM_BYTE + 4];<br>} <b>Meridim90Union</b>;</td>
<td><br>short型で90個の配列データを持つ<br>上記のunsigned short型<br>byte型で180個の配列データを持つ<br>上記のunsigned byte型<br>共用体型名</td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>s_spi_meridim</td>
<td>Meridim配列データ(short型,センサや角度は100倍値)</td>
</tr>
<tr>
<td>r_spi_meridim</td>
<td>Meridim配列データ(short型,センサや角度は100倍値)</td>
</tr>
<tr>
<td>s_spi_meridim_dma</td>
<td>SPI送信用</td>
</tr>
<tr>
<td>r_spi_meridim_dma</td>
<td>SPI受信用</td>
</tr>
<tr>
<td>s_spi_meridim_dummy</td>
<td>送信ダミー用</td>
</tr>
<tr>
<td>s_udp_meridim</td>
<td>UDP送信用</td>
</tr>
<tr>
<td>r_udp_meridim</td>
<td>UDP受信用</td>
</tr>
<tr>
<td>s_udp_meridim_dummy</td>
<td>送信ダミー用</td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>リモコン値格納用の共用体</b></h4>

<table>
<thead>
<tr>
<th>共用体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>typedef union {<br>short sval[PAD_LEN];<br>uint16_t usval[PAD_LEN];<br>int8_t bval[PAD_LEN * 2];<br>uint8_t ubval[PAD_LEN * 2];<br>uint64_t ui64val[1];<br>} <b>PadUnion</b>;</td>
<td><br>short型で5個の配列データを持つ<br>unsigned short型<br>byte型で10個の配列データを持つ<br>unsigned byte型<br>unsigned int16型の配列データを持つ<br>共用体型名</td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>pad_array</td>
<td></td>
</tr>
<tr>
<td>pad_array[0]</td>
<td>ボタンデータのビットフラグ</td>
</tr>
<tr>
<td>pad_array[1]</td>
<td>上位8ビット(int_8):pad.stick_L_x,<br>下位8ビット(int_8):pad.stick_L_y</td>
</tr>
<tr>
<td>pad_array[2]</td>
<td>上位8ビット(int_8):pad.stick_R_x,<br>下位8ビット(int_8):pad.stick_R_y</td>
</tr>
<tr>
<td>pad_array[3]</td>
<td>上位8ビット(uint_8):pad.L2_val,<br>下位8ビット(uint_8):pad.R2_val</td>
</tr>
<tr>
<td>pad_array[4]</td>
<td>チェックサム用(Merimote利用時)</td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>リモコン値格納用の構造体</b></h4>

<table>
<thead>
<tr>
<th>構造体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct <b>PadValue</b> {<br>unsigned short stick_R = 0;<br>int stick_R_x = 0;<br>int stick_R_y = 0;<br>unsigned short stick_L = 0;<br>int stick_L_x = 0;<br>int stick_L_y = 0;<br>unsigned short stick_L2R2V = 0;<br>int R2_val = 0;<br>int L2_val = 0;<br>};</td>
<td><br>stick_R: 右スティックの値<br>stick_R_x: 右スティックのX軸値<br>stick_R_y: 右スティックのY軸値<br>stick_L: 左スティックの値<br>stick_L_x: 左スティックのX軸値<br>stick_L_y: 左スティックのY軸値<br>stick_L2R2V: L2とR2の値<br>R2_val: R2ボタンの値<br>L2_val: L2ボタンの値</td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>pad_analog</td>
<td></td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>フラグ用の構造体</b></h4>

<table>
<thead>
<tr>
<th>構造体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct <b>MrdFlags</b> {<br>bool imuahrs_available = true;<br><br>bool udp_board_passive = false;<br>bool count_frame_reset = false;<br>bool stop_board_during = false;<br>bool eeprom_write_mode = false;<br>bool eeprom_read_mode = false;<br>bool eeprom_protect = EEPROM_PROTECT;<br>bool eeprom_load = EEPROM_LOAD;<br>bool eeprom_set = EEPROM_SET;<br>bool sdcard_write_mode = false;<br>bool sdcard_read_mode = false;<br>bool wire0_init = false;<br>bool wire1_init = false;<br>bool bt_busy = false;<br>bool spi_trans = true;<br>bool spi_rcvd = true;<br>bool udp_rcvd = false;<br>bool udp_busy = false;<br>bool meridim_rcvd = false;<br>bool servoL_drive = false;<br>bool servoR_drive = false;<br>bool servoC_drive = false;<br>};</td>
<td><br>メインセンサ値を読み取る間, <br>サブスレッドによる書き込みを待機<br>UDP通信の周期制御がボード主導(false) か, PC主導(true)か<br>フレーム管理時計をリセットする<br>ボードの末端処理を止める<br>EEPROMへの書き込みモード<br>EEPROMからの読み込みモード<br>EEPROMの書き込みプロテクト<br>起動時にEEPROMの内容を読み込む<br>起動時にEEPROMに規定値をセット<br>SDCARDへの書き込みモード<br>SDCARDからの読み込みモード<br>I2C 0系統の初期化合否<br>I2C 1系統の初期化合否<br>Bluetoothの受信中フラグ（UDPコンフリクト回避用）<br>ESP32とのSPI通信の実施<br>SPIのデータ受信判定<br>UDPのデータ受信判定<br>UDPスレッドでの受信中フラグ（送信抑制）<br>Meridimが正しく受信できたか<br>L系統のサーボの送受信<br>R系統のサーボの送受信<br>C系統のサーボの送受信<br></td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>flg</td>
<td></td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>シーケンス番号用の構造体</b></h4>

<table>
<thead>
<tr>
<th>構造体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct <b>MrdSq</b> {<br>int s_increment = 0;<br>int r_expect = 0;<br>};</td>
<td><br>送信用にフレーム毎に0-59999をカウント<br>受信値との比較用にフレーム毎に0-59999をカウント</td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>mrdsq</td>
<td></td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>タイマー用の構造体</b></h4>

<table>
<thead>
<tr>
<th>構造体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct <b>MrdTimer</b> {<br>long frame_ms = FRAME_DURATION;<br>int loop_count = 0;<br>int loop_count_dlt = 2;<br>int loop_count_max = 359999;<br>};</td>
<td>タイマー管理用の構造体設定. 各変数の説明:<br>1フレームあたりの単位時間(ms)<br>サイン計算用の循環カウンタ<br>サイン計算用の循環カウンタを1フレームにいくつ進めるか<br>循環カウンタの最大値</td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>tmr</td>
<td></td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>エラーカウント用の構造体</b></h4>

<table>
<thead>
<tr>
<th>構造体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct <b>MrdErr</b> {<br>int esp_pc = 0;<br>int pc_esp = 0;<br>int esp_tsy = 0;<br>int tsy_esp = 0;<br>int board_dly = 0;<br>int esp_skip = 0;<br>int tsy_skip = 0;<br>int pc_skip = 0;<br>};</td>
<td><br>ESP32 → PC のUDP受信エラー<br>PC → ESP32 のUDP受信エラー<br>ESP32 → TeensyのSPI受信エラー<br>Teensy → ESP32 のSPI受信エラー<br>Teensy or ESP32のシステムディレイ (末端で捕捉)<br>PC → ESP32 のUDPフレームスキップエラー<br>PC → ESP32 → Teensy のフレームスキップエラー(末端で捕捉)<br>Teensy → ESP32 → PC のフレームスキップエラー(末端で捕捉)</td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>err</td>
<td></td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b> EEPROM読み書き用共用体</b></h4>

<table>
<thead>
<tr>
<th>共用体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>typedef union {<br>uint8_t bval[EEPROM_SIZE];<br>short saval[3][int(EEPROM_SIZE / 4)];<br>short sval[int(EEPROM_SIZE / 2)];<br>} UnionEEPROM;</td>
<td><br>1バイト単位で540個のデータを持つ<br>short型で3*90個の配列データを持つ<br>short型で270個のデータを持つ<br><br></td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>eeprom_write_data</td>
<td>EEPROM書き込み用</td>
</tr>
<tr>
<td>eeprom_read_data</td>
<td>EEPROM読み込み用</td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>6軸,9軸センサー用の構造体</b></h4>

<table>
<thead>
<tr>
<th>構造体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct <b>AhrsValue</b> {<br>Adafruit_BNO055 bno<br> = Adafruit_BNO055(55, 0x28, &amp;Wire);<br>MPU6050 mpu6050;<br>uint8_t mpuIntStatus;<br>uint8_t devStatus;<br>uint16_t packetSize;<br>uint8_t fifoBuffer[64];<br>Quaternion q;<br>VectorFloat gravity;<br>float ypr[3];<br>float yaw_origin = 0;<br>float yaw_source = 0;<br>float read[16];<br>float zeros[16] = {0};<br>float ave_data[16];<br>float result[16];<br>float stock_data[IMUAHRS_STOCK][16];<br>int stock_count = 0;<br>VectorInt16 aa;<br>VectorInt16 gyro;<br>VectorInt16 mag;<br>long temperature;<br>};</td>
<td><br>bno: BNO055のインスタンス<br><br>MPU6050のインスタンス<br>MPUからの実際の割り込みステータスバイト<br>各デバイス操作後のステータス (0 = 成功, !0 = エラー)<br>DMPパケットサイズ (デフォルトは42バイト)<br>FIFOストレージバッファ<br>クォータニオン [w, x, y, z]<br>重力ベクトル [x, y, z]<br>DMPロール, ピッチ, ヨー [x, y, z]<br>ヨー軸のセンター補正値<br>ヨー軸の元データ<br>センサ値の読み込み配列<br>センサ値のゼロリセット用配列<br>移動平均値計算用(データ格納)<br>加工後の最新のmpuデータ(二次データ)<br>移動平均値計算用のデータストック<br>移動平均値計算用<br>加速度センサの測定値[x, y, z]<br>角速度センサの測定値[x, y, z]<br>磁力センサの測定値[x, y, z]<br>温度測定値</td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>ahrs</td>
<td></td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>シリアルモニタリング設定用の構造体</b></h4>

<table>
<thead>
<tr>
<th>構造体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct MrdMonitor {<br>bool frame_delay = MONITOR_FRAME_DELAY;<br>bool flow = MONITOR_FLOW;<br>bool all_err = MONITOR_ERR_ALL;<br>bool servo_err = MONITOR_ERR_SERVO;<br>bool seq_num = MONITOR_SEQ;<br>bool pad = MONITOR_PAD;<br>};</td>
<td><br>フレーム遅延時間を表示<br>フローを表示<br>全経路の受信エラー率を表示<br>サーボエラーを表示<br>シーケンス番号チェックを表示<br>リモコンのデータを表示</td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>monitor</td>
<td></td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>システム用</b></h4>
<table>
<thead>
<tr>
<th>型</th>
<th>変数名</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>uint8_t</td>
<td>*s_spi_meridim_dma</td>
<td>DMA送信用</td>
</tr>
<tr>
<td>uint8_t</td>
<td>*r_spi_meridim_dma</td>
<td>DMA受信用</td>
</tr>
<tr>
<td>TaskHandle_t</td>
<td>thp[4]</td>
<td>マルチスレッドのタスクハンドル格納用</td>
</tr>
</tbody>
</table>
<p><br></p>
<h4><b>サーボパラメータ用の構造体</b></h4>

<table>
<thead>
<tr>
<th>構造体設定</th>
<th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>struct ServoParam {<br>int num_max;<br>int ixl_mount[IXL_MAX];<br>int ixr_mount[IXR_MAX];<br>int ixc_mount[IXC_MAX];<br>int ixl_id[IXL_MAX];<br>int ixr_id[IXR_MAX];<br>int ixc_id[IXC_MAX];<br>int ixl_cw[IXL_MAX];<br>int ixr_cw[IXR_MAX];<br>int ixc_cw[IXC_MAX];<br>float ixl_trim[IXL_MAX];<br>float ixr_trim[IXR_MAX];<br>float ixc_trim[IXC_MAX];<br>float ixl_tgt[IXL_MAX] = {0};<br>float ixr_tgt[IXR_MAX] = {0};<br>float ixc_tgt[IXC_MAX] = {0};<br>float ixl_tgt_past[IXL_MAX] = {0};<br>float ixr_tgt_past[IXR_MAX] = {0};<br>float ixc_tgt_past[IXC_MAX] = {0};<br>int ixl_err[IXL_MAX] = {0};<br>int ixr_err[IXR_MAX] = {0};<br>int ixc_err[IXC_MAX] = {0};<br>iuint16_t ixl_stat[IXL_MAX] = {0};<br>uint16_t ixr_stat[IXR_MAX] = {0};<br>uint16_t ixc_stat[IXC_MAX] = {0};<br>};<br>ServoParam sv;</td>
<td><br>サーボの最大接続 (サーボ送受信のループ処理数)<br>L系統のマウントありなし<br>R系統のマウントありなし<br>C系統のマウントありなし<br>L系統の実サーボ呼び出しID番号<br>R系統の実サーボ呼び出しID番号<br>C系統の実サーボ呼び出しID番号<br>L系統の正逆方向補正<br>R系統の正逆方向補正<br>C系統の正逆方向補正<br>L系統の直立ポーズトリム値<br>R系統の直立ポーズトリム値<br>C系統の直立ポーズトリム値<br>L系統のポジション目標値(degree)<br>R系統のポジション目標値(degree)<br>C系統のポジション目標値(degree)<br>L系統のポジション前回値(degree)<br>R系統のポジション前回値(degree)<br>C系統のポジション前回値(degree)<br>L系統のサーボエラーカウンタ<br>R系統のサーボエラーカウンタ<br>C系統のサーボエラーカウンタ<br>L系統サーボのコンディションステータス配列<br>R系統サーボのコンディションステータス配列<br>C系統サーボのコンディションステータス配列<br></td>
</tr>
<tr>
<td><strong>インスタンス名</strong></td>
<td></td>
</tr>
<tr>
<td>sv</td>
<td></td>
</tr>
</tbody>
</table>

  <br>
    

    
    
      
    

  <div class="row wm-article-nav-buttons" role="navigation" aria-label="navigation">
    
    <div class="wm-article-nav pull-right">
      <a href="../../Library/" class="btn btn-xs btn-default pull-right">
        Next
        <i class="fa fa-chevron-right" aria-hidden="true"></i>
      </a>
      <a href="../../Library/" class="btn btn-xs btn-link">
        Index
      </a>
    </div>
    
    <div class="wm-article-nav">
      <a href="../define_error/" class="btn btn-xs btn-default pull-left">
        <i class="fa fa-chevron-left" aria-hidden="true"></i>
        Previous</a><a href="../define_error/" class="btn btn-xs btn-link">
        #define error
      </a>
    </div>
    
  </div>

    <br>
</div>

<footer class="container-fluid wm-page-content">
  <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>