<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Meridian LITE - My Docs</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">My Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../.." class="nav-link">Home</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">GettingStarted <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active">Meridian LITE</a>
</li>
                                    
<li>
    <a href="../Meridian_TWIN/" class="dropdown-item">Meridian TWIN</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../.." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../Meridian_TWIN/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#meridian_lite" class="nav-link">Meridian_LITE ボードについて</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#meridian_lite_1" class="nav-link">Meridian_LITE インストール方法</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#define-ap_ssid-xxxxxx-ap_ssid" class="nav-link">define AP_SSID "xxxxxx"             // アクセスポイントのAP_SSID</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#define-ap_pass-xxxxxx" class="nav-link">define AP_PASS "xxxxxx"             // アクセスポイントのパスワード</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#define-send_ip-1921681xx-pcippcip" class="nav-link">define SEND_IP "192.168.1.xx"       // 送り先のPCのIPアドレス（PCのIPアドレスを調べておく）</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#define-sd_mount-1" class="nav-link">define SD_MOUNT 1 </a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#define-imu_mount-1" class="nav-link">define IMU_MOUNT 1</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#define-joypad_mount-2" class="nav-link">define JOYPAD_MOUNT 2</a>
              <ul class="nav flex-column">
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="meridian_lite">Meridian_LITE ボードについて</h1>
<p><img width="400" src="https://user-images.githubusercontent.com/8329123/177022808-50ccf555-4afd-450c-a07e-3302771d45cf.jpg"></p>
<p>"Meridian board -LITE-" は半二重通信回路2系統を搭載とSPI,I2Cなどの出力ピンを備えたボードです。<br>
ESP32devkitCを搭載することで、半二重通信方式のコマンドサーボを扱えるロボット用ボードとして機能します。<br>
<br></p>
<h3 id="_1">ピンアサイン</h3>
<p><img width="800" alt="lite_pinassign" src="https://user-images.githubusercontent.com/8329123/177044311-0021c4bc-42ca-4f08-afd5-a440fdac624f.png">
ピンアサインは上記の通りです。<br>
IOがESP32DevkitCのピン番号に該当しているので、ESP32Devkitのデータシート等を参考に使うことができます。<br>
またSPIやSDカードを使用しない場合は、アサインされたピンをGNDと組み合わせるなどで他の役割を与えることもできます。<br>
Fとなっている箇所は未接続のピンとなっています。背面で好きな箇所と導線をはんだ付けすることで自由に機能を与えることができます。<br>
搭載するESP32DevkitCはUSBコネクタがMeridian -LITE-のロゴ側を向くように設置してください。<br>
<br></p>
<h3 id="_2">マウントと機能拡張</h3>
<p><img width="400" alt="SS 2267" src="https://user-images.githubusercontent.com/8329123/177022972-3c9931ae-cfe3-44bb-9145-84303330a387.png">
上図のようにKHR-3HVのランドセルに本体無改造で固定することができます。<br>
ただしランドセル側とボードの間には1~2mm程度のスペーサーが入れるとボード底面の干渉を回避できます。<br>
秋月電子で販売のSDカードホルダ[AE-MICRO-SD-DIP]をSPI端子にそのまま接続することができます。<br>
ただしSDカードホルダ側にメスのピンヘッダを取り付ける必要があります。<br>
９軸センサについては秋月で販売のBNO055[AE-BNO055-BO]をI2Cに接続することを標準としています。<br>
またリモコン受信機KRR-5FHも内臓できます。左下のビス穴のみを使いた簡易固定ができます。<br>
蓋もギリギリですが閉じることができます。<br>
<br></p>
<h2 id="meridian_lite_1">Meridian_LITE インストール方法</h2>
<p>Meridian LITE のボードを使う方法です。<br>
開発環境として、VScodeとPlatformIOを使用します。<br>
※ArduinoIDEを使用した場合、WIFIライブラリの関係でESP32のパフォーマンスが発揮しきれません。<br>
<br></p>
<h3 id="platformio">PlatformIOのインストール</h3>
<p>ご利用の環境にPlatformIOをインストールしてください。<br>
参考URL<br />
https://qiita.com/JotaroS/items/1930f156aab953194c9a<br />
https://platformio.org/<br />
<br></p>
<h3 id="_3">開発環境のインストール</h3>
<p>PlatformIOを起動し、「Platformes」の検索窓で「ESP32」を検索します。<br>
<br>
<img width="300" alt="1" src="https://user-images.githubusercontent.com/8329123/176886184-a702c39d-9b57-41f9-8653-66529a109976.png"><br>
「Espressif 32」が見つかるので、バージョン「3.5.0」をインストールします。<br>
新しいバージョン(4.x.x)だとwifi関連がうまく動かない可能性が高いです。<br>
<br></p>
<h3 id="_4">新規プロジェクトを作成する</h3>
<p><img width="600" alt="2" src="https://user-images.githubusercontent.com/8329123/176886274-bbe57e27-7a14-4a1a-8df7-48d7f7bf495f.png"><br>
「Home」タブより「+New Project」を選びます。<br>
<br>
<img width="400" alt="3" src="https://user-images.githubusercontent.com/8329123/176886509-4ad96264-c89f-4e3f-9b69-21799f7ad162.png"><br>
Name:Meridian_LITE_xxxxxxx<br>
Board:Espressif ESP32 Dev Module<br>
Framework:Arduino Framework<br>
とします。<br>
<br></p>
<h3 id="_5">ライブラリのインストール</h3>
<h4 id="icshardserialclass">IcsHardSerialClassを導入する</h4>
<p><img width="600" alt="SS 2266" src="https://user-images.githubusercontent.com/8329123/177020842-92d11f38-49b1-4cde-86f8-171febd849da.png">
PCのエクスプローラー(Macはファインダ)で内で先ほど作成したプロジェクトのフォルダのある場所を探します。<br>
その中に「lib」があるのを確認します。<br>　
<br>
近藤科学様のサイトより、ICS_Library_for_Arduino_V2_1.zip をDLし、解凍します。<br>
https://kondo-robot.com/faq/ics-library-a2 <br>
解凍後、さらにその中のIcsClass_V210.zipを解凍します。<br>
IcsClass_V210のフォルダを、さきほどの「lib」に入れます。<br>
<br>
<img width="300" alt="SS 2264" src="https://user-images.githubusercontent.com/8329123/177020750-c8210d92-e1d1-4970-a4c3-e04960a4a3f7.png">
ディレクトリ構造が上図のようになっていればOKです。<br>
<br></p>
<h4 id="adafruit_bno055">Adafruit_BNO055を導入する</h4>
<p>アリ頭のアイコンから「QUICK ACCESS」→「PIO Home」→「Open」を開きます。<br>
右画面PIO Homeのタグの左メニューから「Libraries」を選択します。<br>
<img width="400" alt="5" src="https://user-images.githubusercontent.com/8329123/176911609-83cf3795-f890-4c41-88dc-92c2efcfb4ff.png"><br>
今回のプロジェクト（Meridian_LITE_xxxxxx）を選択し、Addボタンを押します。<br>
<br></p>
<h4 id="_6">メインコードの作成</h4>
<p><img width="400" alt="6" src="https://user-images.githubusercontent.com/8329123/176911852-b245204b-b8c9-4379-9db5-7176ab3901d0.png"><br>
再び画面左上のファイルアイコンを押し、「src」→「main.cpp」を選択します。<br>
githubのコード（<a href="https://github.com/Ninagawa123/Meridian_LITE/blob/main/ESP32/Meridian_LITE_20220612/main.cpp">URL</a>）をmain.cppのコードとしてコピペします。<br>
<br></p>
<h4 id="esp32">ESP32のシリアル通信ピンの設定</h4>
<p>ESP32のデフォルトではSerial1のUARTシリアル通信が使う事ができないため、設定を変更して使えるようにします。<br>
<br>
PlatformIOを一旦閉じます。<br>
<br>
https://qiita.com/Ninagawa_Izumi/items/8ce2d55728fd5973087d<br />
を参考に、 <br>
RX1を9番ピンから32番ピンに変更、<br>
TX1を10番ピンから27番ピンに変更する設定をしておきます。<br>
<br></p>
<h4 id="platformioini">platformio.iniの設定</h4>
<p>「platformio.ini」を開くと、<br>
<img width="600" alt="7" src="https://user-images.githubusercontent.com/8329123/176912503-e552925d-ca64-43e9-a7ae-8ce2ff32dd13.png"><br>
のようになっているので、以下のように書き加え、<br>
シリアルモニタのスピードを500000に、またOTAという無線でのプログラム書き換え機能を削除してメモリ領域を増やす設定にします。<br></p>
<blockquote>
<p>[env:esp32dev]<br>
platform = espressif32<br>
board = esp32dev<br>
framework = arduino<br>
monitor_speed = 500000<br>
board_build.partitions = no_ota.csv<br>
lib_deps = adafruit/Adafruit BNO055@^1.5.3<br>
<br></p>
</blockquote>
<h4 id="_7">メインコードの修正</h4>
<p>main.cpp内の<br></p>
<blockquote>
<h1 id="define-ap_ssid-xxxxxx-ap_ssid">define AP_SSID "xxxxxx"             // アクセスポイントのAP_SSID<br></h1>
<h1 id="define-ap_pass-xxxxxx">define AP_PASS "xxxxxx"             // アクセスポイントのパスワード<br></h1>
<h1 id="define-send_ip-1921681xx-pcippcip">define SEND_IP "192.168.1.xx"       // 送り先のPCのIPアドレス（PCのIPアドレスを調べておく）<br></h1>
</blockquote>
<p>を変更する。<br>
送り先のPCのIPアドレスは、<br>
windowsならターミナルを開いてipconfigコマンド<br>
ubuntuならip aコマンド<br>
macなら画面右上のwifiアイコンから"ネットワーク"環境設定...<br>
で確認できます。<br>
<br></p>
<h4 id="_8">メインコードの設定</h4>
<p>main.cpp内の設定を手持ち機体に合わせて変更します。<br>
<br></p>
<blockquote>
<h1 id="define-sd_mount-1">define SD_MOUNT 1 <br></h1>
</blockquote>
<p>→ SDリーダーの搭載 (0:なし, 1:あり)<br>
<br></p>
<blockquote>
<h1 id="define-imu_mount-1">define IMU_MOUNT 1<br></h1>
</blockquote>
<p>→ 6軸or9軸センサーの搭載 (0:なし, 1:BNO055, 2:MPU6050(未実装))<br>
<br></p>
<blockquote>
<h1 id="define-joypad_mount-2">define JOYPAD_MOUNT 2<br></h1>
</blockquote>
<p>→ ジョイパッドの搭載 (現在2のKRC-5FHのみ有効, ジョイパッドを接続しない場合は0)<br>
<br></p>
<blockquote>
<p>/<em> 各サーボのマウントありなし（1:サーボあり、0:サーボなし） </em>/<br></p>
</blockquote>
<p>→ idl_mt[0]〜がサーボ左側系のサーボID 0〜 です。接続しているサーボIDはTrue, 非接続のIDにはFalseを設定します。<br>
　→ idr_mt[0]〜がサーボ右側系のサーボID 0〜 です。上記と同様に設定します。<br>
<br></p>
<blockquote>
<p>/<em> 各サーボの直立デフォルト値　(KRS値  0deg=7500, +-90deg=7500+-2667  KRS値=deg/0.03375) </em>/<br></p>
</blockquote>
<p>→ 各サーボについてのトリム値を設定できます。<br>
<br></p>
<h4 id="_9">ビルドとアップロード</h4>
<p><img width="612" alt="9" src="https://user-images.githubusercontent.com/8329123/176913879-d05eb45d-15a0-47f6-a538-aa481b31e988.png"><br>
画面左下のチェックマークを押すと、ビルドが行われます。<br>
押下して「====== [SUCCESS] Took x.xx seconds」と表示されればビルド成功です。<br>
<br>
PCとESP32をUSBケーブルせ接続し、矢印ボタンを押すとESP32の内容が上書きされます。<br>
アップロードが失敗する場合でも、何度か行うことで成功する場合があるので試してみてください。<br>
<br></p>
<h4 id="pc">PC側の設定</h4>
<p>以降のテキストは準備中ですが、下記を参考にPC側の設定をすることで、デモを動作できると思います。<br>
https://github.com/Ninagawa123/Meridian_core<br>
<br></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
